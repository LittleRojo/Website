<html id="html">
	<head id="head">

		<title id="title">VR Setup</title>
		<meta name="description" content="">
		<meta name="keywords" content="">
		<meta id="author" name="author" content="Me">
		<link rel="alternate" href="https://littlerojo.com" hreflang="en-us" />
		<link rel="shortcut icon" href="https://littlerojo.com/img/vrLogoIcon19.png" type="image/x-icon" />

		<link rel="apple-touch-icon" href="https://littlerojo.com/img/vrLogoIcon19.png">
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-title" content="VR" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
		<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale = 1.0, minimum-scale=1.0, maximum-scale=1.0"/>

		<script>
			var WebVRConfig = { 
				DEFER_INITIALIZATION: true, 
				ROTATE_INSTRUCTIONS_DISABLED: true,
				CARDBOARD_UI_DISABLED: true, 
			}
		</script>

		<script type="text/javascript" src="js/webvr-polyfill.js" async></script>
		<script type="text/javascript" src="js/three.min.js"></script>
		<script type="text/javascript" src="js/OrbitControls.js" async></script>
		<script type="text/javascript" src="js/Tween.js" async></script>
    	<script type="text/javascript" src="js/Webvr.js" async></script>
		<script type="text/javascript" src="js/VRControls.js" async></script>
		<script type="text/javascript" src="js/VREffect.js" async></script>		

		<script type="x-shader/x-vertex" id="vertexShader">
			varying vec3 vWorldPosition;
			void main() {
				vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
				vWorldPosition = worldPosition.xyz;
				gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			}
		</script>
		<script type="x-shader/x-fragment" id="fragmentShader">
			uniform vec3 topColor;
			uniform vec3 bottomColor;
			uniform float offset;
			uniform float exponent;
			varying vec3 vWorldPosition;
			void main() {
				float h = normalize( vWorldPosition + offset ).y;
				gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h , 0.0), exponent ), 0.0 ) ), .1 );
			}
		</script>

		<script>
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
			ga('create', 'UA-80236281-1', 'auto');
			ga('send', 'pageview');
		</script>

	</head>	
	<body style="margin:0px" bgcolor="black">
		<script>
			var stopScene = false;
			function AnimateScene( delta ) {
				if(stopScene) {
					startScene = false;
					return;
				}
				
				orbitControls.update();
				vrControls.update();

				orbitPos = camera.position.clone();
				
				var rotatedPosition = fakeCamera.position.applyQuaternion( camera.quaternion );
				camera.position.add(rotatedPosition);
				camera.quaternion.multiply(fakeCamera.quaternion);  
				
				effect.render( scene, camera );
				effect.requestAnimationFrame( AnimateScene );

				camera.position.copy(orbitPos);
			}

			function onWindowResize( event ){
				if(vrButton !== undefined) {
					vrButton.style.left = window.innerWidth / 2 - 32 + 'px';
					vrButton.style.top = window.innerHeight - 58 + 'px';
				}

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();
				renderer.setSize( window.innerWidth, window.innerHeight );
				effect.setSize( window.innerWidth, window.innerHeight );

				renderer.render( scene, camera );
				effect.render( scene, camera );
			}

			function onMouseDown( event ) {

			}

			function onMouseMove( event ) {

			}

			function onMouseUp( event ) {
				
			}

			function onMouseWheel( event ) {

			}

			function onTouchStart( event ) {

			}

			function onTouchMove( event ) {
				
			}

			function onTouchEnd( event ) {
				
			}

			function onOrientationChange( event ) {
					
			}

			function onKeyDown( event ) {
				
			}

			function getDirectionalLight() {
				dirLight = new THREE.DirectionalLight( 0xffffff, .6 );
				dirLight.position.set( 0, 10, 10 );
				dirLight.castShadow = true;
				dirLight.shadowMapWidth = 2048;
				dirLight.shadowCameraRight = 100;
				dirLight.shadowCameraLeft = -100;
				dirLight.shadowCameraTop = 100;
				dirLight.shadowCameraBottom = -100;
				dirLight.shadowMapHeight = 2048;
				//dirLight.shadowDarkness = 0.5;
				scene.add( dirLight );
			}

			function getSpotLight() {
				spotLight = new THREE.SpotLight( 0xffffff, .8 );
				spotLight.position.set( 0,15,-10 );
				spotLight.shadowMapWidth = 2048;
				spotLight.shadowMapWidth = 2048;
				scene.add(spotLight);
			}

			function getCarpet() {
				var groundGeo = new THREE.PlaneGeometry( 25, 30, 10, 10 );    
				var groundMat = new THREE.MeshPhongMaterial( { color: 0x696969, side: THREE.DoubleSide } );
				
				var ground = new THREE.Mesh( groundGeo, groundMat );
				//ground.rotation.x = -Math.PI/2;
				//ground.rotation.z = deg(25);
				//ground.position.z = -10;
				ground.receiveShadow = true;
				scene.add( ground ); 
			}

			function deg(degree) { 
				return degree*(Math.PI/180); 
			}

			function rand(min, max) {
				return Math.random() * max + min;
			}

			window.addEventListener( 'resize', onWindowResize, false );

			window.addEventListener( 'mousedown', onMouseDown, false );
			window.addEventListener( 'mousemove', onMouseMove, false );
			window.addEventListener( 'mouseup', onMouseUp, false );

			window.addEventListener( 'DOMMouseScroll', onMouseWheel, false ); 

			window.addEventListener( 'touchstart', onTouchStart, false );
			window.addEventListener( 'touchmove', onTouchMove, false );
			window.addEventListener( 'touchend', onTouchEnd, false );
			window.addEventListener( 'orientationchange', onOrientationChange, false );

			window.addEventListener( 'keydown', onKeyDown, false );

			InitializeWebVRPolyfill();

			mainCanvas = document.createElement( 'canvas' );
			
			renderer = new THREE.WebGLRenderer({ canvas:mainCanvas, antilias: true, alpha: true, clearAlpha: 1});
			renderer.setPixelRatio( window.devicePixelRatio );
			renderer.setSize( window.innerWidth, window.innerHeight );
			renderer.setClearColor( 0x000000, 1 );
			renderer.shadowMap.enabled = true;
			renderer.shadowMap.renderReverseSided = false;
			renderer.sortObjects = false;
			
			camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000000);
			camera.position.set(-1, -1, 5);

			orbitControls = new THREE.OrbitControls(camera);
			orbitControls.zoomSpeed = .1;
			orbitControls.rotateSpeed = .001;
			orbitControls.keyPanSpeed = .001;
			
			fakeCamera = new THREE.Object3D();
			vrControls = new THREE.VRControls(fakeCamera);
			effect = new THREE.VREffect( renderer );

			if ( WEBVR.isAvailable() === true ) {
				vrButton = WEBVR.getButton( effect );
				document.body.appendChild( vrButton );
			}

			scene = new THREE.Scene();
			clock = new THREE.Clock();

			/*hemiLight();*/
			getDirectionalLight();
			getSpotLight();
			getCarpet();

			document.body.appendChild( mainCanvas );
			AnimateScene();	
		</script>	
	</body>
</html>