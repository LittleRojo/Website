var Stats = function (parentId) {
	var beginTime = ( performance || Date ).now(), prevTime = beginTime, frames = 0, hz = 0;
	var fpsPanel = new Stats.Panel( parentId );

	return {
		begin: function () {
			beginTime = ( performance || Date ).now();
		},

		end: function () {
			frames ++;
			var time = ( performance || Date ).now();
			var current = ( frames * 1000 ) / ( time - prevTime );
			if(current != hz && current < 100 && time > prevTime + 50) {
				fpsPanel.update( current );				
				prevTime = time;
				frames = 0;
				hz = current;
			}
			return time;
		},

		update: function () {
			beginTime = this.end();
		},
	};
};

Stats.Panel = function ( parentId ) {
	var canvas = document.getElementById( parentId );
	var context = canvas.getContext( '2d' );
	context.font = 'bold 14px Helvetica,Arial,sans-serif';
	context.fillStyle = '#0ff';
	context.textBaseline = 'top';

	return {
		dom: canvas,
		update: function ( value ) {
			context.clearRect(0, 0, canvas.width, canvas.height);
			context.fillText( Math.round( value ) + ' FPS ', 0, 0 );
		}
	};
};

if ( typeof module === 'object' ) {
	module.exports = Stats;
}
